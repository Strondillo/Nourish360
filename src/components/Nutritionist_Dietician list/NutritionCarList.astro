---
import { fetchCustomUsers } from "../../utils/fetchCustomUsers";
import { RND } from "../../types/RND";

// Define the displayed user type
type DisplayUser = {
  name: string;
  specialty: string;
  qualifications: string;
  timings: string;
  image: string;
  available: boolean;
};

let customUsers: DisplayUser[] = [];

try {
  // Fetch the RND accounts
  const fetchedRNDUsers = await fetchCustomUsers();

  // Map the fetched RND users to the display structure
  customUsers = fetchedRNDUsers.map((user: any) => ({
    name: user.name, // Already mapped in fetchRNDAccounts
    specialty: user.specialty,
    qualifications: user.qualifications,
    timings: user.timings,
    image: user.image,
    available: user.available,
  }));
} catch (error) {
  console.error("Error fetching CustomUsers:", error);
}
---

<!-- Display RND Users -->
<section class="custom-users">
  {customUsers.length > 0 ? (
    <div class="grid grid-cols-3 gap-6">
      {customUsers.map((user) => (
        <div class="p-4 bg-white rounded-lg shadow-lg">
          <div class="flex items-center space-x-4">
            <img src={user.image} alt={user.name} class="w-16 h-16 rounded-full">
            <div>
              <h3 class="text-xl font-semibold">{user.name}</h3>
              <p class="text-sm text-yellow-500">{user.specialty}</p>
              <p class="text-xs text-gray-500">{user.qualifications}</p>
              <p class="text-sm">{user.timings}</p>
            </div>
          </div>
          {user.available ? (
            <button class="mt-4 w-full p-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
              Refer
            </button>
          ) : (
            <button class="mt-4 w-full p-2 bg-gray-400 text-white rounded-lg" disabled>
              Not Available
            </button>
          )}
        </div>
      ))}
    </div>
  ) : (
    <p class="text-gray-500">No Registered Nutritionist-Dietitians (RND) found.</p>
  )}
</section>
